@startuml
title Canonical Update Loop (t → t+1)

actor World
participant "CapitalSelector" as CS
participant "EWMAStats" as Stats
participant "StackManager" as SM
participant "SedimentDAG" as SD

== Observe ==
World -> CS: r_k(t), c_k(t)

== Compute Net Flow ==
CS -> CS: R_i(t), C_i(t), Π_i(t)

== Update Statistics ==
CS -> Stats: update(Π_i(t))

== Evaluate Stability ==
CS -> CS: stable_i(t)
SM -> SM: stable_S(t)

== Topology Maintenance ==
SM -> SM: dissolve unstable stacks
SM -> SD: add_node(...) [if dissolved]

== Reweighting ==
CS -> CS: update weights (unless Freeze)

== Rebirth ==
CS -> CS: reset BehavioralState [if triggered]

== Invariant Enforcement ==
CS -> CS: simplex, non-negativity

@enduml
